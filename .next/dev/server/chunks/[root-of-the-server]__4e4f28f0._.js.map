{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/harsh/Downloads/PulseBank-main/PulseBank-main/app/api/chat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const message: string = body?.message;\r\n    const user = body?.user || null; // { role?: string, id?: string }\r\n\r\n    if (!message) {\r\n      return NextResponse.json({ success: false, error: \"Message is required\" }, { status: 400 });\r\n    }\r\n\r\n    // Role-aware AI response logic (simple rule-based, replaceable with real AI)\r\n    const reply = generateAIResponse(message, user);\r\n\r\n    return NextResponse.json({ success: true, reply });\r\n  } catch (error) {\r\n    console.error(\"Chat API error:\", error);\r\n    return NextResponse.json({ success: false, error: \"Failed to process message\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// Role-aware AI response generator\r\nfunction generateAIResponse(message: string, user: { role?: string; id?: string } | null): string {\r\n  const lowerMessage = (message || \"\").toLowerCase();\r\n  const role = user?.role || \"guest\";\r\n\r\n  // Role-specific quick replies\r\n  if (role === \"donor\") {\r\n    if (lowerMessage.includes(\"where\") && lowerMessage.includes(\"donate\")) {\r\n      return \"You can donate at any certified blood center. To schedule, go to the 'Schedule Donation' section in your dashboard â€” enter your availability and preferred hospital.\";\r\n    }\r\n    if (lowerMessage.includes(\"availability\") || lowerMessage.includes(\"available\")) {\r\n      return \"To mark yourself available, share your location and press 'Mark Available' on your dashboard. We'll notify nearby hospitals when you are available.\";\r\n    }\r\n  }\r\n\r\n  if (role === \"recipient\") {\r\n    if (lowerMessage.includes(\"request\") || lowerMessage.includes(\"need\")) {\r\n      return \"To request blood, go to the hospital dashboard and create a new request. Include blood type, units needed, and urgency. Hospitals will notify donors nearby.\";\r\n    }\r\n    if (lowerMessage.includes(\"status\") || lowerMessage.includes(\"track\")) {\r\n      return \"If you've submitted a request, check the Requests table under your hospital dashboard for updates. Hospitals update status once donors respond.\";\r\n    }\r\n  }\r\n\r\n  // General answers (works for all roles)\r\n  if (lowerMessage.includes(\"blood type\") || lowerMessage.includes(\"compatible\")) {\r\n    return \"Blood compatibility depends on the ABO and Rh systems. O- is the universal donor, AB+ is the universal recipient. For specific compatibility, consult medical staff.\";\r\n  }\r\n\r\n  if (lowerMessage.includes(\"donate\") || lowerMessage.includes(\"donation\")) {\r\n    return \"Whole blood can be donated every 56 days (8 weeks). Ensure you meet eligibility criteria and stay hydrated. Contact local centers for appointment details.\";\r\n  }\r\n\r\n  if (lowerMessage.includes(\"health\") || lowerMessage.includes(\"safe\")) {\r\n    return \"Blood donation is safe when performed at licensed centers; donors are screened and procedures are followed to ensure safety.\";\r\n  }\r\n\r\n  if (lowerMessage.includes(\"hi\") || lowerMessage.includes(\"hello\") || lowerMessage.includes(\"hey\")) {\r\n    return `Hello${role && role !== \"guest\" ? \" \" + role : \"\"}! I'm Pulse Bot. I can help with donation info, requests, scheduling, and your dashboard.`;\r\n  }\r\n\r\n  if (lowerMessage.includes(\"hospital\") || lowerMessage.includes(\"service\")) {\r\n    return \"Pulse Bank connects donors and recipients. Use the dashboards to create requests, mark availability, and schedule donations.\";\r\n  }\r\n\r\n  // Fallback\r\n  return \"I can help with blood donation info, scheduling, requests and dashboard actions. Please ask a specific question or include your role (donor/recipient/hospital).\";\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,UAAkB,MAAM;QAC9B,MAAM,OAAO,MAAM,QAAQ,MAAM,iCAAiC;QAElE,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,6EAA6E;QAC7E,MAAM,QAAQ,mBAAmB,SAAS;QAE1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAM;IAClD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjG;AACF;AAEA,mCAAmC;AACnC,SAAS,mBAAmB,OAAe,EAAE,IAA2C;IACtF,MAAM,eAAe,CAAC,WAAW,EAAE,EAAE,WAAW;IAChD,MAAM,OAAO,MAAM,QAAQ;IAE3B,8BAA8B;IAC9B,IAAI,SAAS,SAAS;QACpB,IAAI,aAAa,QAAQ,CAAC,YAAY,aAAa,QAAQ,CAAC,WAAW;YACrE,OAAO;QACT;QACA,IAAI,aAAa,QAAQ,CAAC,mBAAmB,aAAa,QAAQ,CAAC,cAAc;YAC/E,OAAO;QACT;IACF;IAEA,IAAI,SAAS,aAAa;QACxB,IAAI,aAAa,QAAQ,CAAC,cAAc,aAAa,QAAQ,CAAC,SAAS;YACrE,OAAO;QACT;QACA,IAAI,aAAa,QAAQ,CAAC,aAAa,aAAa,QAAQ,CAAC,UAAU;YACrE,OAAO;QACT;IACF;IAEA,wCAAwC;IACxC,IAAI,aAAa,QAAQ,CAAC,iBAAiB,aAAa,QAAQ,CAAC,eAAe;QAC9E,OAAO;IACT;IAEA,IAAI,aAAa,QAAQ,CAAC,aAAa,aAAa,QAAQ,CAAC,aAAa;QACxE,OAAO;IACT;IAEA,IAAI,aAAa,QAAQ,CAAC,aAAa,aAAa,QAAQ,CAAC,SAAS;QACpE,OAAO;IACT;IAEA,IAAI,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,YAAY,aAAa,QAAQ,CAAC,QAAQ;QACjG,OAAO,CAAC,KAAK,EAAE,QAAQ,SAAS,UAAU,MAAM,OAAO,GAAG,yFAAyF,CAAC;IACtJ;IAEA,IAAI,aAAa,QAAQ,CAAC,eAAe,aAAa,QAAQ,CAAC,YAAY;QACzE,OAAO;IACT;IAEA,WAAW;IACX,OAAO;AACT","debugId":null}}]
}