{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/harsh/Downloads/PulseBank-main/PulseBank-main/app/hospital/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useRef } from \"react\";\nimport { jwtDecode } from \"jwt-decode\";\nimport { io } from \"socket.io-client\";\n\nexport default function HospitalDashboard() {\n  const [hospitalId, setHospitalId] = useState<string | null>(null);\n  const [requests, setRequests] = useState<any[]>([]);\n  const [schedules, setSchedules] = useState<any[]>([]);\n  const socketRef = useRef<any>(null);\n\n  // -------------------------------\n  // Get Hospital ID from Token\n  // -------------------------------\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      const decoded: any = jwtDecode(token);\n      setHospitalId(decoded.userId);\n    }\n  }, []);\n\n  // -------------------------------\n  // Real-time Socket Listener\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    const socket = io(\"http://localhost:5000\");\n    socketRef.current = socket;\n\n    socket.on(\"connect\", () => {\n      socket.emit(\"register\", hospitalId);\n    });\n\n    socket.on(\"new_schedule\", (schedule) => {\n      setSchedules((prev) => [...prev, schedule]);\n      alert(\"üì© NEW DONATION SCHEDULE FROM DONOR\");\n    });\n\n    return () => socket.disconnect();\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Fetch All Hospital Requests\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    fetch(`http://localhost:5000/hospital/requests/${hospitalId}`)\n      .then((res) => res.json())\n      .then((data) => setRequests(data.requests || []));\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Fetch Pending Schedules\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    fetch(`http://localhost:5000/hospital/schedules/${hospitalId}`)\n      .then((res) => res.json())\n      .then((data) => setSchedules(data.schedules || []));\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Accept or Reject Donation\n  // -------------------------------\n  const updateScheduleStatus = async (scheduleId: string, status: string) => {\n    const res = await fetch(\"http://localhost:5000/schedule/confirm\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ scheduleId, status }),\n    });\n\n    const data = await res.json();\n\n    if (data.success) {\n      setSchedules((prev) =>\n        prev.map((s) => (s._id === scheduleId ? { ...s, status } : s))\n      );\n    } else {\n      alert(\"Error updating status\");\n    }\n  };\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 p-10\">\n      <h1 className=\"text-3xl font-bold text-red-700 mb-6\">\n        üè• Hospital Dashboard\n      </h1>\n\n      {/* -------------------- */}\n      {/* SECTION: Requests */}\n      {/* -------------------- */}\n      <div className=\"bg-white p-6 rounded-xl shadow mb-10\">\n        <h2 className=\"text-2xl font-bold mb-4\">Your Active Requests</h2>\n\n        {!requests.length && <p>No requests created yet.</p>}\n\n        {requests.map((req) => (\n          <div key={req._id} className=\"p-4 border rounded-lg mb-3 bg-red-50\">\n            <h3 className=\"font-bold text-lg\">{req.bloodType}</h3>\n            <p>Units Needed: {req.unitsNeeded}</p>\n            <p>Urgency: {req.urgency}</p>\n          </div>\n        ))}\n      </div>\n\n      {/* -------------------- */}\n      {/* SECTION: Schedules */}\n      {/* -------------------- */}\n      <div className=\"bg-white p-6 rounded-xl shadow\">\n        <h2 className=\"text-2xl font-bold mb-4\">Pending Donor Schedules</h2>\n\n        {!schedules.length && <p>No scheduled donors yet.</p>}\n\n        {schedules.map((sch) => (\n          <div key={sch._id} className=\"p-4 border rounded-lg mb-3 bg-blue-50\">\n            <h3 className=\"text-lg font-bold\">Donor: {sch.donorId?.fullName}</h3>\n            <p>Date: {sch.date}</p>\n            <p>Time: {sch.time}</p>\n            <p>Contact: {sch.contact}</p>\n\n            <p className=\"mt-2 font-bold\">\n              Status:{\" \"}\n              <span\n                className={\n                  sch.status === \"accepted\"\n                    ? \"text-green-700\"\n                    : sch.status === \"rejected\"\n                    ? \"text-red-700\"\n                    : \"text-orange-600\"\n                }\n              >\n                {sch.status}\n              </span>\n            </p>\n\n            {sch.status === \"pending\" && (\n              <div className=\"flex gap-4 mt-3\">\n                <button\n                  onClick={() => updateScheduleStatus(sch._id, \"accepted\")}\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-lg\"\n                >\n                  Accept\n                </button>\n\n                <button\n                  onClick={() => updateScheduleStatus(sch._id, \"rejected\")}\n                  className=\"bg-red-600 text-white px-4 py-2 rounded-lg\"\n                >\n                  Reject\n                </button>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}