{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/harsh/Downloads/PulseBank-main/PulseBank-main/app/donor/history/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { Heart, ArrowLeft } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function DonorHistory() {\r\n  const [donorId, setDonorId] = useState<string | null>(null);\r\n  const [donorName, setDonorName] = useState(\"Donor\");\r\n  const [schedules, setSchedules] = useState<any[]>([]);\r\n  const [hospitalRequests, setHospitalRequests] = useState<any[]>([]);\r\n  const [recipientRequests, setRecipientRequests] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"user\");\r\n    if (stored) {\r\n      const user = JSON.parse(stored);\r\n      setDonorId(user._id || user.id || null);\r\n      setDonorName(user.fullName || \"Donor\");\r\n    }\r\n    // fallback: try to decode token\r\n    if (!stored) {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (token) {\r\n        try {\r\n          const d: any = jwtDecode(token);\r\n          setDonorId(d.userId || d._id || null);\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch history data\r\n  useEffect(() => {\r\n    if (!donorId) return;\r\n\r\n    Promise.all([\r\n      fetch(`http://localhost:5000/schedule/donor/${donorId}`).then((res) => res.json()),\r\n      fetch(`http://localhost:5000/request/all`).then((res) => res.json()),\r\n    ])\r\n      .then(([scheduleRes, requestRes]) => {\r\n        // Filter completed schedules\r\n        const completedSchedules = (scheduleRes.schedules || []).filter(\r\n          (s: any) => s.status && (s.status.toLowerCase() === \"completed\" || s.status.toLowerCase() === \"cancelled\")\r\n        );\r\n        setSchedules(completedSchedules);\r\n\r\n        // Filter requests\r\n        const all = requestRes.requests || [];\r\n        const hospitals = all.filter((r: any) => r.hospital && r.hospital !== \"\" && !r.isRecipientRequest);\r\n        const recipients = all.filter((r: any) => r.isRecipientRequest || !r.hospital || r.hospital === \"\");\r\n\r\n        const completedHospitals = hospitals.filter(\r\n          (r: any) => r.confirmationStatus && (r.confirmationStatus === \"Successful\" || r.confirmationStatus === \"Rejected\")\r\n        );\r\n        const completedRecipients = recipients.filter(\r\n          (r: any) => r.confirmationStatus && (r.confirmationStatus === \"Successful\" || r.confirmationStatus === \"Rejected\")\r\n        );\r\n\r\n        setHospitalRequests(completedHospitals);\r\n        setRecipientRequests(completedRecipients);\r\n      })\r\n      .catch((err) => console.error(\"Error fetching history:\", err))\r\n      .finally(() => setLoading(false));\r\n  }, [donorId]);\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-linear-to-br from-white via-red-50 to-white\">\r\n      {/* HEADER */}\r\n      <header className=\"bg-red-600 text-white p-6 shadow-lg sticky top-0 z-50\">\r\n        <div className=\"max-w-4xl mx-auto flex items-center gap-4\">\r\n          <Link href=\"/donor/dashboard\" className=\"hover:opacity-80 transition\">\r\n            <ArrowLeft className=\"w-6 h-6\" />\r\n          </Link>\r\n          <Heart className=\"w-8 h-8 fill-white\" />\r\n          <h1 className=\"text-2xl font-bold\">Donation Request History</h1>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"max-w-4xl mx-auto p-6\">\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 space-y-8\">\r\n          {loading ? (\r\n            <div className=\"text-center py-12\">\r\n              <p className=\"text-gray-600 text-lg\">Loading history...</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {/* Scheduled Donations History */}\r\n              {schedules.length > 0 && (\r\n                <div className=\"space-y-4\">\r\n                  <h2 className=\"text-2xl font-bold text-red-700 flex items-center gap-2\">\r\n                    üìÖ Scheduled Donations\r\n                  </h2>\r\n                  <div className=\"space-y-3\">\r\n                    {schedules.map((s: any, idx: number) => (\r\n                      <div key={idx} className=\"p-5 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border-l-4 border-blue-500 shadow-sm hover:shadow-md transition\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div className=\"flex-1\">\r\n                            <p className=\"text-lg font-bold text-blue-900\">{s.requestId?.hospital || s.hospital || \"Hospital\"}</p>\r\n                            <div className=\"mt-2 space-y-1 text-sm text-blue-700\">\r\n                              <p>üìÖ <span className=\"font-semibold\">{s.date}</span> @ <span className=\"font-semibold\">{s.time}</span></p>\r\n                              <p>üíâ Units: <span className=\"font-semibold\">{s.requestId?.unitsNeeded || s.unitsNeeded}</span> | Blood: <span className=\"font-semibold\">{s.requestId?.bloodType || s.bloodType}</span></p>\r\n                            </div>\r\n                          </div>\r\n                          <span className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ml-4 ${\r\n                            s.status.toLowerCase() === \"completed\"\r\n                              ? \"bg-green-200 text-green-800\"\r\n                              : \"bg-orange-200 text-orange-800\"\r\n                          }`}>\r\n                            {s.status.toUpperCase()}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Hospital Requests History */}\r\n              {hospitalRequests.length > 0 && (\r\n                <div className=\"border-t pt-6 space-y-4\">\r\n                  <h2 className=\"text-2xl font-bold text-red-700 flex items-center gap-2\">\r\n                    üè• Hospital Requests\r\n                  </h2>\r\n                  <div className=\"space-y-3\">\r\n                    {hospitalRequests.map((req: any, idx: number) => (\r\n                      <div key={idx} className={`p-5 rounded-lg border-l-4 shadow-sm hover:shadow-md transition ${\r\n                        req.confirmationStatus === \"Successful\"\r\n                          ? \"bg-gradient-to-r from-green-50 to-green-100 border-green-500\"\r\n                          : \"bg-gradient-to-r from-red-50 to-red-100 border-red-500\"\r\n                      }`}>\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div className=\"flex-1\">\r\n                            <p className={`text-lg font-bold ${req.confirmationStatus === \"Successful\" ? \"text-green-900\" : \"text-red-900\"}`}>\r\n                              {req.hospital}\r\n                            </p>\r\n                            <div className=\"mt-2 space-y-1 text-sm\">\r\n                              <p className={req.confirmationStatus === \"Successful\" ? \"text-green-700\" : \"text-red-700\"}>\r\n                                üíâ {req.unitsNeeded} units ‚Äî ü©∏ {req.bloodType}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <span className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ml-4 ${\r\n                            req.confirmationStatus === \"Successful\"\r\n                              ? \"bg-green-200 text-green-800\"\r\n                              : \"bg-red-200 text-red-800\"\r\n                          }`}>\r\n                            {req.confirmationStatus.toUpperCase()}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Recipient Requests History */}\r\n              {recipientRequests.length > 0 && (\r\n                <div className=\"border-t pt-6 space-y-4\">\r\n                  <h2 className=\"text-2xl font-bold text-red-700 flex items-center gap-2\">\r\n                    üë• Recipient Requests\r\n                  </h2>\r\n                  <div className=\"space-y-3\">\r\n                    {recipientRequests.map((req: any, idx: number) => (\r\n                      <div key={idx} className={`p-5 rounded-lg border-l-4 shadow-sm hover:shadow-md transition ${\r\n                        req.confirmationStatus === \"Successful\"\r\n                          ? \"bg-gradient-to-r from-green-50 to-green-100 border-green-500\"\r\n                          : \"bg-gradient-to-r from-red-50 to-red-100 border-red-500\"\r\n                      }`}>\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div className=\"flex-1\">\r\n                            <p className={`text-lg font-bold ${req.confirmationStatus === \"Successful\" ? \"text-green-900\" : \"text-red-900\"}`}>\r\n                              {req.recipientName || req.requestedBy?.fullName || \"Recipient\"}\r\n                            </p>\r\n                            <div className=\"mt-2 space-y-1 text-sm\">\r\n                              <p className={req.confirmationStatus === \"Successful\" ? \"text-green-700\" : \"text-red-700\"}>\r\n                                üíâ {req.unitsNeeded} units ‚Äî ü©∏ {req.bloodType}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <span className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ml-4 ${\r\n                            req.confirmationStatus === \"Successful\"\r\n                              ? \"bg-green-200 text-green-800\"\r\n                              : \"bg-red-200 text-red-800\"\r\n                          }`}>\r\n                            {req.confirmationStatus.toUpperCase()}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Empty State */}\r\n              {schedules.length === 0 && hospitalRequests.length === 0 && recipientRequests.length === 0 && (\r\n                <div className=\"text-center py-12\">\r\n                  <Heart className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n                  <p className=\"text-gray-600 text-lg\">No donation history yet</p>\r\n                  <p className=\"text-gray-500 text-sm mt-2\">Your completed and rejected donations will appear here</p>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}