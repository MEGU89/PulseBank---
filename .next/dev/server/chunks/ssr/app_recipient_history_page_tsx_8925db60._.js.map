{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/harsh/Downloads/PulseBank-main/PulseBank-main/app/recipient/history/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { Heart, ArrowLeft, CheckCircle, Clock } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function RecipientHistory() {\r\n  const [recipientId, setRecipientId] = useState<string | null>(null);\r\n  const [recipientName, setRecipientName] = useState(\"Recipient\");\r\n  const [requests, setRequests] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"user\");\r\n    if (stored) {\r\n      const user = JSON.parse(stored);\r\n      setRecipientId(user._id || user.id || null);\r\n      setRecipientName(user.fullName || \"Recipient\");\r\n    }\r\n    // fallback: try to decode token\r\n    if (!stored) {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (token) {\r\n        try {\r\n          const d: any = jwtDecode(token);\r\n          setRecipientId(d.userId || d._id || null);\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch request history\r\n  useEffect(() => {\r\n    if (!recipientId) return;\r\n\r\n    fetch(\"http://localhost:5000/request/all\")\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        const all = data.requests || [];\r\n        // Filter only requests made by THIS recipient\r\n        const myRequests = all.filter(\r\n          (req: any) => req.requestedBy === recipientId\r\n        );\r\n        setRequests(myRequests);\r\n      })\r\n      .catch((err) => console.error(\"Error fetching history:\", err))\r\n      .finally(() => setLoading(false));\r\n  }, [recipientId]);\r\n\r\n  // Get status color\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"Fulfilled\":\r\n        return \"bg-green-50 border-green-300 text-green-700\";\r\n      case \"Pending\":\r\n        return \"bg-orange-50 border-orange-300 text-orange-700\";\r\n      default:\r\n        return \"bg-gray-50 border-gray-300 text-gray-700\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gradient-to-br from-white via-red-50 to-white\">\r\n      {/* HEADER */}\r\n      <header className=\"bg-gradient-to-r from-red-600 to-red-700 text-white p-6 shadow-lg sticky top-0 z-50\">\r\n        <div className=\"max-w-4xl mx-auto flex items-center gap-4\">\r\n          <Link href=\"/recipient/dashboard\" className=\"hover:opacity-80 transition\">\r\n            <ArrowLeft className=\"w-6 h-6\" />\r\n          </Link>\r\n          <Heart className=\"w-8 h-8 fill-white\" />\r\n          <h1 className=\"text-2xl font-bold\">Blood Request History</h1>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"max-w-4xl mx-auto p-6\">\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 space-y-8\">\r\n          {loading ? (\r\n            <div className=\"text-center py-12\">\r\n              <p className=\"text-gray-600 text-lg\">Loading history...</p>\r\n            </div>\r\n          ) : requests.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <Heart className=\"w-16 h-16 text-red-200 mx-auto mb-4\" />\r\n              <p className=\"text-gray-600 text-lg\">No blood requests yet</p>\r\n              <Link\r\n                href=\"/recipient/create-request\"\r\n                className=\"mt-4 inline-block px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white font-bold rounded-lg hover:shadow-lg transition\"\r\n              >\r\n                Create New Request\r\n              </Link>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <h2 className=\"text-2xl font-bold text-red-700 flex items-center gap-2\">\r\n                <Heart className=\"w-6 h-6 fill-red-600\" />\r\n                All Blood Requests\r\n              </h2>\r\n\r\n              <div className=\"grid gap-4\">\r\n                {requests.map((req: any, idx: number) => (\r\n                  <div\r\n                    key={idx}\r\n                    className={`p-6 rounded-xl border-2 hover:shadow-lg transition ${getStatusColor(req.status)}`}\r\n                  >\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                      <div>\r\n                        <h3 className=\"text-lg font-bold text-gray-800 mb-2\">\r\n                          {req.bloodType} Blood Type\r\n                        </h3>\r\n                        <p className=\"text-gray-600 text-sm\">\r\n                          {new Date(req.createdAt).toLocaleDateString()}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-white bg-opacity-60\">\r\n                        {req.status === \"Fulfilled\" ? (\r\n                          <>\r\n                            <CheckCircle className=\"w-5 h-5 text-green-600\" />\r\n                            <span className=\"font-bold text-green-600\">Fulfilled</span>\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <Clock className=\"w-5 h-5 text-orange-600\" />\r\n                            <span className=\"font-bold text-orange-600\">Pending</span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid md:grid-cols-3 gap-4 border-t pt-4\">\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 font-bold uppercase mb-1\">Units Needed</p>\r\n                        <p className=\"text-2xl font-bold text-red-600\">{req.unitsNeeded}</p>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 font-bold uppercase mb-1\">Hospital</p>\r\n                        <p className=\"text-lg font-semibold text-gray-800\">{req.hospital || \"N/A\"}</p>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 font-bold uppercase mb-1\">Urgency</p>\r\n                        <p className=\"text-lg font-semibold text-orange-600\">{req.urgency || \"MODERATE\"}</p>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Status Details */}\r\n                    <div className=\"mt-4 pt-4 border-t\">\r\n                      <p className=\"text-xs text-gray-600 font-bold uppercase mb-2\">Request Status</p>\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className={`w-3 h-3 rounded-full ${req.status === \"Fulfilled\" ? \"bg-green-600\" : \"bg-orange-400\"}`}></div>\r\n                          <span className=\"text-gray-700\">\r\n                            {req.status === \"Fulfilled\" ? \"Request Fulfilled\" : \"Awaiting Donation\"}\r\n                          </span>\r\n                        </div>\r\n                        {req.status === \"Fulfilled\" && (\r\n                          <>\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className=\"w-3 h-3 rounded-full bg-green-600\"></div>\r\n                              <span className=\"text-gray-700\">Donor Matched</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className=\"w-3 h-3 rounded-full bg-green-600\"></div>\r\n                              <span className=\"text-gray-700\">Blood Delivered</span>\r\n                            </div>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}