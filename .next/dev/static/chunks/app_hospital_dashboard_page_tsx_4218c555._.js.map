{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/harsh/Downloads/PulseBank-main/PulseBank-main/app/hospital/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useRef } from \"react\";\nimport { jwtDecode } from \"jwt-decode\";\nimport { io } from \"socket.io-client\";\n\nexport default function HospitalDashboard() {\n  const [hospitalId, setHospitalId] = useState<string | null>(null);\n  const [requests, setRequests] = useState<any[]>([]);\n  const [schedules, setSchedules] = useState<any[]>([]);\n  const socketRef = useRef<any>(null);\n\n  // -------------------------------\n  // Get Hospital ID from Token\n  // -------------------------------\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      const decoded: any = jwtDecode(token);\n      setHospitalId(decoded.userId);\n    }\n  }, []);\n\n  // -------------------------------\n  // Real-time Socket Listener\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    const socket = io(\"http://localhost:5000\");\n    socketRef.current = socket;\n\n    socket.on(\"connect\", () => {\n      socket.emit(\"register\", hospitalId);\n    });\n\n    socket.on(\"new_schedule\", (schedule) => {\n      setSchedules((prev) => [...prev, schedule]);\n      alert(\"üì© NEW DONATION SCHEDULE FROM DONOR\");\n    });\n\n    return () => socket.disconnect();\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Fetch All Hospital Requests\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    fetch(`http://localhost:5000/hospital/requests/${hospitalId}`)\n      .then((res) => res.json())\n      .then((data) => setRequests(data.requests || []));\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Fetch Pending Schedules\n  // -------------------------------\n  useEffect(() => {\n    if (!hospitalId) return;\n\n    fetch(`http://localhost:5000/hospital/schedules/${hospitalId}`)\n      .then((res) => res.json())\n      .then((data) => setSchedules(data.schedules || []));\n  }, [hospitalId]);\n\n  // -------------------------------\n  // Accept or Reject Donation\n  // -------------------------------\n  const updateScheduleStatus = async (scheduleId: string, status: string) => {\n    const res = await fetch(\"http://localhost:5000/schedule/confirm\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ scheduleId, status }),\n    });\n\n    const data = await res.json();\n\n    if (data.success) {\n      setSchedules((prev) =>\n        prev.map((s) => (s._id === scheduleId ? { ...s, status } : s))\n      );\n    } else {\n      alert(\"Error updating status\");\n    }\n  };\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 p-10\">\n      <h1 className=\"text-3xl font-bold text-red-700 mb-6\">\n        üè• Hospital Dashboard\n      </h1>\n\n      {/* -------------------- */}\n      {/* SECTION: Requests */}\n      {/* -------------------- */}\n      <div className=\"bg-white p-6 rounded-xl shadow mb-10\">\n        <h2 className=\"text-2xl font-bold mb-4\">Your Active Requests</h2>\n\n        {!requests.length && <p>No requests created yet.</p>}\n\n        {requests.map((req) => (\n          <div key={req._id} className=\"p-4 border rounded-lg mb-3 bg-red-50\">\n            <h3 className=\"font-bold text-lg\">{req.bloodType}</h3>\n            <p>Units Needed: {req.unitsNeeded}</p>\n            <p>Urgency: {req.urgency}</p>\n          </div>\n        ))}\n      </div>\n\n      {/* -------------------- */}\n      {/* SECTION: Schedules */}\n      {/* -------------------- */}\n      <div className=\"bg-white p-6 rounded-xl shadow\">\n        <h2 className=\"text-2xl font-bold mb-4\">Pending Donor Schedules</h2>\n\n        {!schedules.length && <p>No scheduled donors yet.</p>}\n\n        {schedules.map((sch) => (\n          <div key={sch._id} className=\"p-4 border rounded-lg mb-3 bg-blue-50\">\n            <h3 className=\"text-lg font-bold\">Donor: {sch.donorId?.fullName}</h3>\n            <p>Date: {sch.date}</p>\n            <p>Time: {sch.time}</p>\n            <p>Contact: {sch.contact}</p>\n\n            <p className=\"mt-2 font-bold\">\n              Status:{\" \"}\n              <span\n                className={\n                  sch.status === \"accepted\"\n                    ? \"text-green-700\"\n                    : sch.status === \"rejected\"\n                    ? \"text-red-700\"\n                    : \"text-orange-600\"\n                }\n              >\n                {sch.status}\n              </span>\n            </p>\n\n            {sch.status === \"pending\" && (\n              <div className=\"flex gap-4 mt-3\">\n                <button\n                  onClick={() => updateScheduleStatus(sch._id, \"accepted\")}\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-lg\"\n                >\n                  Accept\n                </button>\n\n                <button\n                  onClick={() => updateScheduleStatus(sch._id, \"rejected\")}\n                  className=\"bg-red-600 text-white px-4 py-2 rounded-lg\"\n                >\n                  Reject\n                </button>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}