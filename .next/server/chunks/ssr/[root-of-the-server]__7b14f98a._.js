module.exports=[9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},45747,a=>{"use strict";class b extends Error{}function c(a,c){let d;if("string"!=typeof a)throw new b("Invalid token specified: must be a string");c||(c={});let e=+(!0!==c.header),f=a.split(".")[e];if("string"!=typeof f)throw new b(`Invalid token specified: missing part #${e+1}`);try{d=function(a){let b=a.replace(/-/g,"+").replace(/_/g,"/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw Error("base64 string is not of the correct length")}try{var c;return c=b,decodeURIComponent(atob(c).replace(/(.)/g,(a,b)=>{let c=b.charCodeAt(0).toString(16).toUpperCase();return c.length<2&&(c="0"+c),"%"+c}))}catch(a){return atob(b)}}(f)}catch(a){throw new b(`Invalid token specified: invalid base64 for part #${e+1} (${a.message})`)}try{return JSON.parse(d)}catch(a){throw new b(`Invalid token specified: invalid json for part #${e+1} (${a.message})`)}}b.prototype.name="InvalidTokenError",a.s(["jwtDecode",()=>c])},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__"},88644,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"InvariantError",{enumerable:!0,get:function(){return d}});class d extends Error{constructor(a,b){super(`Invariant: ${a.endsWith(".")?a:a+"."} This is a bug in Next.js.`,b),this.name="InvariantError"}}},54427,(a,b,c)=>{"use strict";function d(){let a,b,c=new Promise((c,d)=>{a=c,b=d});return{resolve:a,reject:b,promise:c}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createPromiseWithResolvers",{enumerable:!0,get:function(){return d}})},76472,a=>{"use strict";let b=(0,a.i(70106).default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);a.s(["Heart",()=>b],76472)},210,a=>{"use strict";let b=(0,a.i(70106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},24987,a=>{"use strict";let b=(0,a.i(70106).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],24987)},26112,a=>{"use strict";let b=(0,a.i(70106).default)("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]);a.s(["Droplet",()=>b],26112)},28193,a=>{"use strict";let b=(0,a.i(70106).default)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);a.s(["Loader",()=>b],28193)},16201,a=>{"use strict";let b=(0,a.i(70106).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],16201)},41997,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},92e3,a=>{"use strict";let b=(0,a.i(70106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],92e3)},63220,a=>{"use strict";let b="http://localhost:5000",c={donationHistory:a=>`${b}/donor/history/${a}`,urgentRequests:`${b}/donor/requests`,addDonation:`${b}/donor/add`},d={addRequest:`${b}/request/add`,getAllRequests:`${b}/request/all`};a.s(["DONOR",0,c,"REQUEST",0,d])},31643,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(24987),e=a.i(28193),f=a.i(92e3),g=a.i(16201);a.s(["LocationDetector",0,({onLocationDetected:a,label:h="Your Location",showMap:i=!1})=>{let{location:j,isLoading:k,error:l,detectedAddress:m,requestLocation:n,clearError:o}=(()=>{let[a,b]=(0,c.useState)(null),[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(null),j=async(a,b)=>{try{let c=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${b}&zoom=18&addressdetails=1`),d=await c.json();if(d.address){let a=d.address,b=[];return a.house_number&&b.push(a.house_number),a.road&&b.push(a.road),a.suburb?b.push(a.suburb):a.neighbourhood?b.push(a.neighbourhood):a.village?b.push(a.village):a.hamlet&&b.push(a.hamlet),a.city?b.push(a.city):a.town&&b.push(a.town),a.postcode&&b.push(`Pin Code ${a.postcode}`),a.state&&b.push(a.state),a.country&&b.push(a.country),b.filter(Boolean).join(", ")||"Location detected"}return"Location detected"}catch(a){return console.error("Error fetching address:",a),"Location detected"}};return{location:a,isLoading:d,error:f,detectedAddress:h,requestLocation:(0,c.useCallback)(()=>{if(e(!0),g(null),!navigator.geolocation){g("Geolocation not supported on this device"),e(!1);return}navigator.geolocation.getCurrentPosition(async a=>{try{let{latitude:c,longitude:d}=a.coords;console.log("[useLocationDetection] Got coordinates:",c,d);let e=await j(c,d);b({latitude:c,longitude:d,address:e}),i(e),g(null)}catch(a){console.error("Error processing location:",a),g("Failed to process location")}finally{e(!1)}},a=>{let c="Failed to get location";a.code===a.PERMISSION_DENIED?c="Location permission denied. Enable it in browser settings.":a.code===a.POSITION_UNAVAILABLE?c="Location unavailable. Make sure location services are enabled.":a.code===a.TIMEOUT&&(c="Location request timed out. Check your internet and try again."),console.error("[useLocationDetection] Geolocation error:",a.code,c),g(c),b(null),e(!1)},{timeout:3e4,enableHighAccuracy:!0,maximumAge:0})},[]),clearError:(0,c.useCallback)(()=>{g(null)},[])}})(),[p,q]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{j&&!i&&(console.log("[LocationDetector] Auto-confirming location:",j),a(j.latitude,j.longitude))},[j,i]),(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:[h," ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full p-3 border border-gray-300 rounded-lg bg-white",children:[(0,b.jsx)(d.MapPin,{className:"w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Click 'Detect Location' to enable location services",value:m||"",readOnly:!0,className:"flex-1 outline-none bg-transparent text-gray-700 placeholder-gray-400"}),(0,b.jsx)("button",{onClick:n,disabled:k,className:"px-4 py-1 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Loader,{className:"w-4 h-4 animate-spin"}),"Detecting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.MapPin,{className:"w-4 h-4"}),"Detect Location"]})})]})}),l&&(0,b.jsxs)("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[(0,b.jsx)(f.AlertCircle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-red-800 font-semibold text-sm",children:"Error"}),(0,b.jsx)("p",{className:"text-red-700 text-sm",children:l})]}),(0,b.jsx)("button",{onClick:o,className:"ml-2 text-red-600 hover:text-red-700 font-semibold text-sm",children:"Dismiss"})]}),p&&j&&(0,b.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Confirm Location:"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:m||`${j.latitude.toFixed(6)}, ${j.longitude.toFixed(6)}`})]}),(0,b.jsx)("div",{className:"w-full h-64 rounded-lg overflow-hidden mb-3",children:(0,b.jsx)("iframe",{title:"Location Map",width:"100%",height:"100%",frameBorder:"0",src:`https://www.openstreetmap.org/export/embed.html?bbox=${j.longitude-.01},${j.latitude-.01},${j.longitude+.01},${j.latitude+.01}&layer=mapnik&marker=${j.latitude},${j.longitude}`})}),(0,b.jsx)("button",{onClick:()=>{j&&(a(j.latitude,j.longitude),q(!1))},className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700",children:"Use This Location"})]}),j&&!p&&(0,b.jsxs)("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg flex items-start gap-2",children:[(0,b.jsx)(g.CheckCircle,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-green-800 font-semibold text-sm",children:"Location Captured"}),(0,b.jsxs)("p",{className:"text-green-700 text-xs mt-1",children:["Latitude: ",j.latitude.toFixed(6),(0,b.jsx)("br",{}),"Longitude: ",j.longitude.toFixed(6)]})]})]})]})}],31643)},43606,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(63220),f=a.i(45747),g=a.i(210),h=a.i(76472),i=a.i(26112),j=a.i(38246),k=a.i(31643);function l(){let a=(0,d.useRouter)(),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)({bloodType:"O+",unitsNeeded:1,urgency:"LOW",locationKm:20,hospital:"",recipientName:""}),[v,w]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=localStorage.getItem("token");if(a)try{let b=(0,f.jwtDecode)(a);"recipient"===b.role&&m(b.userId)}catch(a){console.error("Invalid token:",a)}if(!a){let a=localStorage.getItem("user");if(a)try{let b=JSON.parse(a);m(b.id||b._id||null)}catch(a){}}},[]);let x=async(a,b)=>{s({lat:a,lng:b}),await y(a,b)},y=async(a,b)=>{try{let c=await fetch("http://localhost:5000/hospital/all"),d=((await c.json()).hospitals||[]).filter(c=>!!c.location&&!!c.location.latitude&&!!c.location.longitude&&z(a,b,c.location.latitude,c.location.longitude)<=t.locationKm);q(d)}catch(a){console.error("Error fetching hospitals:",a)}},z=(a,b,c,d)=>{let e=(c-a)*Math.PI/180,f=(d-b)*Math.PI/180,g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2);return 2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))*6371},A=a=>{let{name:b,value:c}=a.target;u(a=>({...a,[b]:"unitsNeeded"===b||"locationKm"===b?Number(c):c})),"hospital"===b&&c&&w(p.find(a=>(a.hospitalName||a.fullName||a.name)===c)||null)},B=async b=>{if(b.preventDefault(),o(!0),!l){alert("Recipient ID not found. Please log in again."),o(!1);return}let c={...t,requestedBy:l,isRecipientRequest:!0,destinationHospital:t.hospital,location:v?.location||r,hospitalId:v?._id||v?.id,hospitalName:t.hospital,hospitalPhone:v?.phone,hospitalAddress:v?.location?.address};try{let b=await fetch(e.REQUEST.addRequest,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d=await b.json();if(!b.ok){alert(d.message||"Failed to submit request."),o(!1);return}alert("Blood request created successfully!"),a.push("/recipient/dashboard")}catch(a){console.error("Error:",a),alert("Something went wrong.")}o(!1)};return(0,b.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-white via-red-50 to-white",children:[(0,b.jsx)("header",{className:"bg-gradient-to-r from-red-600 to-red-700 text-white p-6 shadow-lg",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto flex items-center gap-4",children:[(0,b.jsx)(j.default,{href:"/recipient/dashboard",className:"hover:bg-red-500 p-2 rounded-lg transition",title:"Back to Dashboard",children:(0,b.jsx)(g.ArrowLeft,{className:"w-6 h-6"})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Droplet,{className:"w-8 h-8 fill-white"}),(0,b.jsx)(h.Heart,{className:"w-6 h-6 fill-white"})]}),(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Create Blood Request"})]})]})}),(0,b.jsx)("div",{className:"max-w-2xl mx-auto p-6",children:(0,b.jsxs)("form",{onSubmit:B,className:"bg-white shadow-lg rounded-xl p-8 space-y-6 border-l-4 border-red-600",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block font-semibold text-gray-700 mb-2",children:"Recipient/Patient Name *"}),(0,b.jsx)("input",{type:"text",name:"recipientName",value:t.recipientName,onChange:A,required:!0,placeholder:"Enter recipient or patient name",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,b.jsx)(k.LocationDetector,{onLocationDetected:x,label:"Your Location",showMap:!1}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block font-semibold text-gray-700 mb-2",children:["Hospital Name ",r&&"*"]}),r&&p.length>0?(0,b.jsxs)("select",{name:"hospital",value:t.hospital,onChange:A,required:null!==r,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600",children:[(0,b.jsx)("option",{value:"",children:"Select a nearby hospital"}),p.map((a,c)=>(0,b.jsx)("option",{value:a.hospitalName||a.fullName||a.name||"Hospital",children:a.hospitalName||a.fullName||a.name||"Hospital"},c))]}):r&&0===p.length?(0,b.jsx)("div",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-yellow-50",children:(0,b.jsx)("p",{className:"text-gray-600",children:"No hospitals found nearby. Please try again or enter hospital name manually."})}):(0,b.jsx)("input",{type:"text",name:"hospital",value:t.hospital,onChange:A,placeholder:"Share location to find nearby hospitals or enter manually",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block font-semibold text-gray-700 mb-2",children:"Blood Type"}),(0,b.jsx)("select",{name:"bloodType",value:t.bloodType,onChange:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600",children:["O+","O-","A+","A-","B+","B-","AB+","AB-"].map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block font-semibold text-gray-700 mb-2",children:"Units Needed"}),(0,b.jsx)("input",{type:"number",name:"unitsNeeded",value:t.unitsNeeded,onChange:A,min:1,max:10,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block font-semibold text-gray-700 mb-2",children:"Urgency Level"}),(0,b.jsxs)("select",{name:"urgency",value:t.urgency,onChange:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600",children:[(0,b.jsx)("option",{value:"LOW",children:"Low"}),(0,b.jsx)("option",{value:"MODERATE",children:"Moderate"}),(0,b.jsx)("option",{value:"HIGH",children:"High"}),(0,b.jsx)("option",{value:"CRITICAL",children:"Critical"})]})]}),(0,b.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,b.jsx)("button",{type:"submit",disabled:n,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Creating...":"Create Request"}),(0,b.jsx)(j.default,{href:"/recipient/dashboard",className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-3 rounded-lg text-center transition",children:"Cancel"})]})]})})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7b14f98a._.js.map