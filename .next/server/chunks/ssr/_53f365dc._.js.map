{"version":3,"sources":["turbopack:///[project]/node_modules/jwt-decode/build/esm/index.js","turbopack:///[project]/lib/api-endpoints.ts","turbopack:///[project]/app/donor/stats/page.tsx"],"sourcesContent":["export class InvalidTokenError extends Error {\n}\nInvalidTokenError.prototype.name = \"InvalidTokenError\";\nfunction b64DecodeUnicode(str) {\n    return decodeURIComponent(atob(str).replace(/(.)/g, (m, p) => {\n        let code = p.charCodeAt(0).toString(16).toUpperCase();\n        if (code.length < 2) {\n            code = \"0\" + code;\n        }\n        return \"%\" + code;\n    }));\n}\nfunction base64UrlDecode(str) {\n    let output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n        case 0:\n            break;\n        case 2:\n            output += \"==\";\n            break;\n        case 3:\n            output += \"=\";\n            break;\n        default:\n            throw new Error(\"base64 string is not of the correct length\");\n    }\n    try {\n        return b64DecodeUnicode(output);\n    }\n    catch (err) {\n        return atob(output);\n    }\n}\nexport function jwtDecode(token, options) {\n    if (typeof token !== \"string\") {\n        throw new InvalidTokenError(\"Invalid token specified: must be a string\");\n    }\n    options || (options = {});\n    const pos = options.header === true ? 0 : 1;\n    const part = token.split(\".\")[pos];\n    if (typeof part !== \"string\") {\n        throw new InvalidTokenError(`Invalid token specified: missing part #${pos + 1}`);\n    }\n    let decoded;\n    try {\n        decoded = base64UrlDecode(part);\n    }\n    catch (e) {\n        throw new InvalidTokenError(`Invalid token specified: invalid base64 for part #${pos + 1} (${e.message})`);\n    }\n    try {\n        return JSON.parse(decoded);\n    }\n    catch (e) {\n        throw new InvalidTokenError(`Invalid token specified: invalid json for part #${pos + 1} (${e.message})`);\n    }\n}\n","// Change this URL to your deployed backend later\nexport const API_BASE_URL = \"http://localhost:5000\";\n\n// =============================\n// AUTH ENDPOINTS\n// =============================\nexport const AUTH = {\n  register: `${API_BASE_URL}/auth/register`,\n  login: `${API_BASE_URL}/auth/login`,\n  me: `${API_BASE_URL}/auth/me`,  // optional\n};\n\n// =============================\n// DONOR ENDPOINTS\n// =============================\nexport const DONOR = {\n  donationHistory: (donorId: string) =>\n    `${API_BASE_URL}/donor/history/${donorId}`,\n\n  urgentRequests: `${API_BASE_URL}/donor/requests`,\n\n  addDonation: `${API_BASE_URL}/donor/add`,\n};\n\n// =============================\n// HOSPITAL ENDPOINTS\n// =============================\nexport const HOSPITAL = {\n  createRequest: `${API_BASE_URL}/request/add`,\n  getRequests: `${API_BASE_URL}/request/all`,\n};\n\n// =============================\n// RECIPIENT ENDPOINTS\n// =============================\nexport const RECIPIENT = {\n  getRequests: (recipientId: string) =>\n    `${API_BASE_URL}/recipient/requests/${recipientId}`,\n\n  requestStatus: (recipientId: string, requestId: string) =>\n    `${API_BASE_URL}/recipient/requests/${recipientId}/${requestId}`,\n};\n\n// =============================\n// REQUEST (General) ENDPOINTS\n// =============================\nexport const REQUEST = {\n  addRequest: `${API_BASE_URL}/request/add`,\n  getAllRequests: `${API_BASE_URL}/request/all`,\n};\n","\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { DONOR } from \"@/lib/api-endpoints\";\r\n\r\nexport default function DonorStatsPage() {\r\n  const [stats, setStats] = useState({\r\n    totalDonations: 0,\r\n    totalUnits: 0,\r\n    lastDonationDate: \"\",\r\n    nextEligibleDate: \"\",\r\n    mostDonatedBloodType: \"\",\r\n  });\r\n\r\n  const [donorId, setDonorId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // STEP 1 — Decode JWT to get donor ID\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      const decoded: any = jwtDecode(token);\r\n      setDonorId(decoded.userId);\r\n    }\r\n  }, []);\r\n\r\n  // STEP 2 — Fetch donation history and calculate stats\r\n  useEffect(() => {\r\n    if (!donorId) return;\r\n\r\n    fetch(DONOR.donationHistory(donorId))\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        const donations = data.donations || [];\r\n\r\n        if (donations.length === 0) {\r\n          setStats({\r\n            totalDonations: 0,\r\n            totalUnits: 0,\r\n            lastDonationDate: \"N/A\",\r\n            nextEligibleDate: \"Eligible Now\",\r\n            mostDonatedBloodType: \"N/A\",\r\n          });\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Total donations\r\n        const totalDonations = donations.length;\r\n\r\n        // Units donated\r\n        const totalUnits = donations.reduce((sum: number, d: any) => sum + d.units, 0);\r\n\r\n        // Most recent donation\r\n        const lastDonation = donations[0]; // sorted from newest to oldest\r\n        const lastDate = lastDonation.date?.slice(0, 10) || \"N/A\";\r\n\r\n        // Next eligible donation date (every 90 days)\r\n        const nextEligible = new Date(lastDonation.date);\r\n        nextEligible.setDate(nextEligible.getDate() + 90);\r\n\r\n        const nextEligibleDate = nextEligible.toISOString().slice(0, 10);\r\n\r\n        // Most donated blood type\r\n        const bloodCount: any = {};\r\n        donations.forEach((donation: any) => {\r\n          if (!bloodCount[donation.bloodType]) {\r\n            bloodCount[donation.bloodType] = 0;\r\n          }\r\n          bloodCount[donation.bloodType] += 1;\r\n        });\r\n\r\n        const mostDonatedBloodType =\r\n          Object.entries(bloodCount).sort((a: any, b: any) => b[1] - a[1])[0]?.[0] || \"N/A\";\r\n\r\n        // Set calculated stats\r\n        setStats({\r\n          totalDonations,\r\n          totalUnits,\r\n          lastDonationDate: lastDate,\r\n          nextEligibleDate,\r\n          mostDonatedBloodType,\r\n        });\r\n\r\n        setLoading(false);\r\n      })\r\n      .catch((err) => console.error(err));\r\n  }, [donorId]);\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-8\">Your Donation Statistics</h1>\r\n\r\n      {loading ? (\r\n        <p className=\"text-gray-600\">Loading stats...</p>\r\n      ) : (\r\n        <div className=\"grid md:grid-cols-2 gap-6\">\r\n          {/* Total Donations */}\r\n          <StatCard title=\"Total Donations\" value={stats.totalDonations} color=\"red\" />\r\n\r\n          {/* Total Units Donated */}\r\n          <StatCard title=\"Total Units Donated\" value={stats.totalUnits} color=\"green\" />\r\n\r\n          {/* Last Donation Date */}\r\n          <StatCard title=\"Last Donation Date\" value={stats.lastDonationDate} color=\"blue\" />\r\n\r\n          {/* Next Eligible Date */}\r\n          <StatCard title=\"Next Eligible Donation\" value={stats.nextEligibleDate} color=\"purple\" />\r\n\r\n          {/* Most Donated Blood Type */}\r\n          <StatCard title=\"Most Donated Blood Type\" value={stats.mostDonatedBloodType} color=\"yellow\" />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StatCard({\r\n  title,\r\n  value,\r\n  color,\r\n}: {\r\n  title: string;\r\n  value: any;\r\n  color: string;\r\n}) {\r\n  const bg = {\r\n    red: \"bg-red-100 text-red-700\",\r\n    green: \"bg-green-100 text-green-700\",\r\n    blue: \"bg-blue-100 text-blue-700\",\r\n    purple: \"bg-purple-100 text-purple-700\",\r\n    yellow: \"bg-yellow-100 text-yellow-700\",\r\n  }[color];\r\n\r\n  return (\r\n    <div className={`p-6 rounded-xl shadow bg-white border-l-4 ${bg}`}>\r\n      <h3 className=\"text-lg font-semibold\">{title}</h3>\r\n      <p className=\"text-3xl font-bold mt-2\">{value}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","ignoreList":[0]}