(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47293,e=>{"use strict";class t extends Error{}function a(e,a){let r;if("string"!=typeof e)throw new t("Invalid token specified: must be a string");a||(a={});let s=+(!0!==a.header),l=e.split(".")[s];if("string"!=typeof l)throw new t(`Invalid token specified: missing part #${s+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var a;return a=t,decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch(e){return atob(t)}}(l)}catch(e){throw new t(`Invalid token specified: invalid base64 for part #${s+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new t(`Invalid token specified: invalid json for part #${s+1} (${e.message})`)}}t.prototype.name="InvalidTokenError",e.s(["jwtDecode",()=>a])},18566,(e,t,a)=>{t.exports=e.r(76562)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],3116)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},78583,e=>{"use strict";let t=(0,e.i(75254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},63209,e=>{"use strict";let t=(0,e.i(75254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},9546,e=>{"use strict";var t=e.i(43476),a=e.i(18566),r=e.i(71645),s=e.i(46897),l=e.i(43432),o=e.i(87316),n=e.i(3116),i=e.i(78583),d=e.i(63209),c=e.i(47293);function u(){let e=(0,a.useSearchParams)(),u=e.get("requestId"),h=e.get("hospital"),m=e.get("units"),p=e.get("bloodType"),[b,x]=(0,r.useState)(null),[g,f]=(0,r.useState)(null),[y,j]=(0,r.useState)(null),[w,v]=(0,r.useState)(!1),[k,N]=(0,r.useState)(""),[S,C]=(0,r.useState)(""),[D,T]=(0,r.useState)(""),[M,P]=(0,r.useState)(""),[I,L]=(0,r.useState)(null),[$,A]=(0,r.useState)(null),[E,O]=(0,r.useState)(!1),[q,H]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(e){let t=(0,c.jwtDecode)(e);x(t.userId),z(t.userId)}},[]);let z=async e=>{try{let t=await fetch(`http://localhost:5000/donor/last-donation/${e}`),a=await t.json();if(a.success&&a.lastDonationDate){let e=new Date(a.lastDonationDate);L(e.toISOString().split("T")[0]);let t=new Date(e);t.setDate(t.getDate()+56);let r=t.toISOString().split("T")[0];A(r),new Date<t&&O(!0)}}catch(e){console.error("Error loading last donation date:",e)}},U=async(e,t)=>{try{let a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`),r=await a.json();if(r.address){let e=r.address,t=[];return e.house_number&&t.push(e.house_number),e.road&&t.push(e.road),e.suburb?t.push(e.suburb):e.neighbourhood?t.push(e.neighbourhood):e.village?t.push(e.village):e.hamlet&&t.push(e.hamlet),e.city?t.push(e.city):e.town&&t.push(e.town),e.postcode&&t.push(`Pin Code ${e.postcode}`),e.state&&t.push(e.state),e.country&&t.push(e.country),t.filter(Boolean).join(", ")||"Location detected"}return"Location detected"}catch(e){return console.error("Error fetching address:",e),"Location detected"}},Y=async()=>{if(!b||!u||!k||!S||!D||!g)return alert("Please fill all required fields.");if($&&S<$)return alert(`⏳ You must wait until ${$} to schedule your next donation (56 days from last donation).`);let e=await fetch("http://localhost:5000/schedule/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({donorId:b,requestId:u,donorLocation:{latitude:g.lat,longitude:g.lng},contact:k,date:S,time:D,notes:M})}),t=await e.json();t.success?(alert("Donation Schedule Confirmed!"),window.location.href="/donor/dashboard"):alert("Error: "+t.message)};return(0,t.jsx)("main",{className:"min-h-screen bg-red-50 p-10 flex justify-center",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-xl max-w-2xl w-full border border-red-200",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-red-700 mb-6",children:"❤️ Schedule Blood Donation"}),(0,t.jsxs)("div",{className:"p-4 border border-red-200 rounded-lg mb-6 bg-red-50",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-red-700",children:"Hospital Information"}),(0,t.jsx)("p",{className:"mt-2 text-lg font-semibold",children:h||"Unknown Hospital"}),(0,t.jsxs)("p",{className:"mt-3 p-3 bg-red-100 rounded-lg text-red-700 font-semibold",children:["Needed: ",(0,t.jsxs)("b",{children:[m," units"]})," of ",(0,t.jsx)("b",{children:p})]})]}),(0,t.jsxs)("button",{onClick:()=>{navigator.geolocation.getCurrentPosition(async e=>{f({lat:e.coords.latitude,lng:e.coords.longitude}),v(!0);try{let t=await U(e.coords.latitude,e.coords.longitude);j(t)}catch(e){console.error("Error getting address:",e)}finally{v(!1)}alert("Location captured!")},()=>alert("Location access denied"))},className:"w-full bg-blue-600 text-white py-3 rounded-lg flex justify-center gap-2 items-center mb-4",children:[(0,t.jsx)(s.MapPin,{})," Share My Location"]}),g&&(0,t.jsxs)("p",{className:"text-green-700 mb-4 font-semibold",children:["Location: ",w?(0,t.jsx)("span",{className:"italic",children:"Loading address..."}):y||"Location detected"]}),E&&(0,t.jsx)("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 mb-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,t.jsx)(d.AlertCircle,{className:"text-amber-600 w-5 h-5 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-bold text-amber-800",children:"⏳ 56-Day Cooldown Period"}),(0,t.jsxs)("p",{className:"text-amber-700 text-sm mt-1",children:["Your last donation was on ",(0,t.jsx)("b",{children:I}),"."]}),(0,t.jsxs)("p",{className:"text-amber-700 text-sm font-semibold mt-1",children:["You can next schedule a donation after: ",(0,t.jsx)("b",{children:$})]})]})]})}),(0,t.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(l.Phone,{})," Contact Number"]}),(0,t.jsx)("input",{type:"text",placeholder:"Enter phone number",className:"w-full border rounded-lg p-3 mb-4",value:k,onChange:e=>N(e.target.value)}),(0,t.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(o.Calendar,{})," Select Date"]}),(0,t.jsx)("input",{type:"date",className:"w-full border rounded-lg p-3 mb-2",value:S,onChange:e=>{var t;C(t=e.target.value),H(""),$&&(t<$?H(`❌ You can only schedule donations after ${$}. You must wait 56 days from your last donation.`):H(""))},min:$||void 0,disabled:E}),q&&(0,t.jsx)("div",{className:"text-red-600 text-sm font-semibold mb-4 bg-red-50 p-3 rounded-lg border border-red-200",children:q}),!q&&S&&$&&S>=$&&(0,t.jsx)("div",{className:"text-green-600 text-sm font-semibold mb-4 bg-green-50 p-3 rounded-lg border border-green-200 flex items-center gap-2",children:"✅ This date is valid for scheduling your donation."}),(0,t.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(n.Clock,{})," Select Time"]}),(0,t.jsx)("input",{type:"time",className:"w-full border rounded-lg p-3 mb-4",value:D,onChange:e=>T(e.target.value)}),(0,t.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(i.FileText,{})," Notes (Optional)"]}),(0,t.jsx)("textarea",{placeholder:"Any additional information...",className:"w-full border rounded-lg p-3 mb-4 h-24",value:M,onChange:e=>P(e.target.value)}),(0,t.jsx)("button",{onClick:Y,className:"w-full bg-red-600 text-white py-3 rounded-lg font-bold text-lg",children:"Confirm Donation Schedule"})]})})}function h(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"p-8",children:"Loading..."}),children:(0,t.jsx)(u,{})})}e.s(["default",()=>h])}]);