"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{7521:function(e,t,s){s.r(t),s.d(t,{default:function(){return m}});var l=s(7437),a=s(2265),r=s(3609),n=s(3041),o=s(3774),d=s(8997),i=s(1671),c=s(9322),u=s(166),h=s(7648);let x=(0,u.default)(()=>s.e(251).then(s.bind(s,6251)),{loadableGenerated:{webpack:()=>[6251]},ssr:!1});function m(e){let{hospitalRequests:t,donorLocation:s}=e,[u,m]=(0,a.useState)([]),[p,b]=(0,a.useState)(null),[g,f]=(0,a.useState)({}),[j,N]=(0,a.useState)(!1),v=(e,t,s,l)=>{let a=(s-e)*Math.PI/180,r=(l-t)*Math.PI/180,n=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return Math.round(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*63710)/10};(0,a.useEffect)(()=>{if(s&&t&&t.length>0){console.log("[HospitalRequestsMap] Received requests:",t);let e=t.map(e=>{if(e.location&&e.location.latitude&&e.location.longitude){let t=v(s.lat,s.lng,e.location.latitude,e.location.longitude);return{...e,distance:Math.round(10*t)/10}}return{...e,distance:null}}).filter(e=>null!==e&&(null===e.distance||e.distance<=20)).sort((e,t)=>null===e.distance?1:null===t.distance?-1:e.distance-t.distance);m(e);let l=e.reduce((e,t)=>{let s=t.hospital||"Hospital";return e[s]||(e[s]=[]),e[s].push(t),e},{});f(l),console.log("[HospitalRequestsMap] Grouped by hospital:",Object.keys(l))}},[s,t]);let y=u.length>0?u.filter(e=>e.location&&e.location.latitude&&e.location.longitude).map(e=>({location:e.location,name:e.hospital||"Hospital",notes:"".concat(e.unitsNeeded||"?"," units — ").concat(e.bloodType||"?").concat(e.recipientName?" (".concat(e.recipientName,")"):"")})):[],w=Object.keys(g).map(e=>{var t;let s=g[e],l=s[0];return{name:e,distance:l.distance,requestCount:s.length,phone:l.phone,address:null===(t=l.location)||void 0===t?void 0:t.address}}).sort((e,t)=>null===e.distance?1:null===t.distance?-1:(e.distance||0)-(t.distance||0));return(0,l.jsxs)("div",{className:"space-y-6 bg-white rounded-2xl shadow-xl p-8 border-2 border-red-200",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)(r.Z,{className:"w-8 h-8 text-red-600 fill-red-600"}),(0,l.jsx)("h2",{className:"text-3xl font-bold text-red-700",children:"Nearby Blood Requests"})]}),y.length>0&&(0,l.jsx)("div",{className:"rounded-2xl overflow-hidden shadow-lg h-96 border-2 border-red-100 mb-8",children:(0,l.jsx)(x,{hospitals:y,activeDonors:[],currentLocation:s})}),w.length>0?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-600",children:[(0,l.jsx)("p",{className:"text-xs font-bold text-red-700 uppercase tracking-wide",children:"\uD83C\uDFE5 Select Hospital to View All Requests"}),(0,l.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[w.length," hospitals found within 0-20 km"]})]}),(0,l.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map((e,t)=>{var s;return(0,l.jsxs)("button",{onClick:()=>b(p===e.name?null:e.name),className:"p-4 rounded-xl text-left transition-all duration-200 border-2 ".concat(p===e.name?"bg-red-100 border-red-600 shadow-lg":"bg-gradient-to-r from-white to-red-50 border-red-200 hover:border-red-400 hover:shadow-md"),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,l.jsx)("h3",{className:"font-bold text-gray-800 text-sm line-clamp-2 flex-1",children:e.name}),(0,l.jsxs)("span",{className:"bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full flex-shrink-0 ml-2",children:[(null===(s=e.distance)||void 0===s?void 0:s.toFixed(1))||"0"," km"]})]}),(0,l.jsxs)("div",{className:"space-y-1 text-xs text-gray-600 mb-2",children:[e.phone&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(n.Z,{className:"w-3 h-3 text-red-500"}),(0,l.jsx)("span",{className:"font-semibold",children:e.phone})]}),e.address&&(0,l.jsxs)("div",{className:"flex items-start gap-1",children:[(0,l.jsx)(o.Z,{className:"w-3 h-3 text-blue-500 flex-shrink-0 mt-0.5"}),(0,l.jsx)("span",{className:"line-clamp-2",children:e.address})]})]}),(0,l.jsxs)("div",{className:"inline-block bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:[e.requestCount," request",e.requestCount>1?"s":""]})]},t)})})]}):s?(0,l.jsxs)("div",{className:"bg-blue-50 rounded-2xl p-12 text-center border-2 border-blue-200",children:[(0,l.jsx)(d.Z,{className:"w-16 h-16 text-blue-300 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600 font-medium",children:"No hospital requests found"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Check back later for new blood requests"})]}):(0,l.jsxs)("div",{className:"bg-blue-50 rounded-2xl p-12 text-center border-2 border-blue-200",children:[(0,l.jsx)(o.Z,{className:"w-16 h-16 text-blue-300 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600 font-medium",children:"Share your location to see nearby requests"})]}),p&&g[p]&&(0,l.jsxs)("div",{className:"mt-8 pt-8 border-t-4 border-red-300",children:[(0,l.jsxs)("h3",{className:"text-2xl font-bold text-red-700 mb-2 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCD"}),p]}),(0,l.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:["Showing ",g[p].length," total request(s) - Hospital (",g[p].filter(e=>!e.isRecipientRequest).length,") & Recipient (",g[p].filter(e=>e.isRecipientRequest).length,") requests"]}),(0,l.jsx)("div",{className:"space-y-4",children:g[p].map((e,t)=>{var s,a,r;return(0,l.jsxs)("div",{className:"border-2 rounded-xl p-6 hover:shadow-lg transition-all ".concat(e.isRecipientRequest?"bg-gradient-to-r from-white to-purple-50 border-purple-200":"bg-gradient-to-r from-white to-blue-50 border-blue-200"),children:[(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[e.isRecipientRequest?(0,l.jsxs)("span",{className:"bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:["RE-",null===(s=e._id)||void 0===s?void 0:s.substring(0,6).toUpperCase()]}):(0,l.jsxs)("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:["HRE-",null===(a=e._id)||void 0===a?void 0:a.substring(0,6).toUpperCase()]}),(0,l.jsxs)("span",{className:"text-sm font-semibold text-gray-700",children:[e.bloodType," • ",e.unitsNeeded," units"]})]}),e.recipientName&&(0,l.jsxs)("div",{className:"bg-purple-50 rounded-lg p-2 border-l-2 border-purple-600 mb-3",children:[(0,l.jsx)("p",{className:"text-xs text-gray-600 font-bold",children:"PATIENT NAME"}),(0,l.jsx)("p",{className:"text-sm font-semibold text-purple-700",children:e.recipientName})]}),(0,l.jsxs)("div",{className:"text-sm space-y-1 text-gray-700",children:[e.phone&&(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Phone:"})," ",e.phone]}),e.urgency&&(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Urgency:"})," ",(0,l.jsx)("span",{className:"text-orange-600 font-bold",children:e.urgency})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-3 justify-center",children:[(0,l.jsx)(h.default,{href:"/donor/schedule-donation?requestId=".concat(e._id,"&hospital=").concat(encodeURIComponent(e.hospital||""),"&units=").concat(e.unitsNeeded,"&bloodType=").concat(encodeURIComponent(e.bloodType||"")),className:"block",children:(0,l.jsxs)("button",{className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-4 rounded-lg font-bold text-sm transition-all duration-200 shadow-md hover:shadow-lg active:scale-95 flex items-center justify-center gap-2",children:[(0,l.jsx)(i.Z,{className:"w-4 h-4"}),"Confirm & Schedule"]})}),(0,l.jsxs)("button",{onClick:async()=>{try{let t=await fetch("http://localhost:5000/request/".concat(e._id,"/confirm"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"Rejected",confirmedBy:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")||"{}").id:null,notes:"Request rejected by donor"})}),s=await t.json();s.success?(alert("❌ Request rejected successfully"),m(t=>t.filter(t=>t._id!==e._id))):alert("Error: "+(s.message||"Unknown error"))}catch(e){alert("Error: "+(e instanceof Error?e.message:"Unknown error"))}},className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 px-4 rounded-lg font-bold text-sm transition-all duration-200 shadow-md hover:shadow-lg active:scale-95 flex items-center justify-center gap-2",children:[(0,l.jsx)(c.Z,{className:"w-4 h-4"}),"Reject"]})]})]}),(null===(r=e.location)||void 0===r?void 0:r.address)&&(0,l.jsxs)("div",{className:"text-sm text-gray-600 flex items-start gap-2 pt-3 border-t border-red-200",children:[(0,l.jsx)(o.Z,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),(0,l.jsx)("span",{children:e.location.address})]})]},t)})})]})]})}},3609:function(e,t,s){s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]])},3041:function(e,t,s){s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])}}]);