(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{7241:function(e,t,r){Promise.resolve().then(r.bind(r,4825))},4825:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(7437),a=r(9376),o=r(2265),s=r(3774),l=r(9322),i=r(3041),c=r(1047),d=r(1723),u=r(8736),h=r(4474);function m(){let e=(0,a.useSearchParams)(),t=e.get("requestId"),r=e.get("hospital"),m=e.get("units"),f=e.get("bloodType"),[p,g]=(0,o.useState)(null),[b,x]=(0,o.useState)(null),[y,w]=(0,o.useState)(null),[j,v]=(0,o.useState)(!1),[k,N]=(0,o.useState)(""),[S,C]=(0,o.useState)(""),[Z,E]=(0,o.useState)(""),[L,P]=(0,o.useState)(""),[D,I]=(0,o.useState)(null),[M,A]=(0,o.useState)(null),[O,T]=(0,o.useState)(!1),[_,q]=(0,o.useState)("");(0,o.useEffect)(()=>{let e=localStorage.getItem("token");if(e){let t=(0,h.o)(e);g(t.userId),$(t.userId)}},[]);let $=async e=>{try{let t=await fetch("http://localhost:5000/donor/last-donation/".concat(e)),r=await t.json();if(r.success&&r.lastDonationDate){let e=new Date(r.lastDonationDate);I(e.toISOString().split("T")[0]);let t=new Date(e);t.setDate(t.getDate()+56);let n=t.toISOString().split("T")[0];A(n),new Date<t&&T(!0)}}catch(e){console.error("Error loading last donation date:",e)}},z=e=>{C(e),q(""),M&&(e<M?q("❌ You can only schedule donations after ".concat(M,". You must wait 56 days from your last donation.")):q(""))},H=async(e,t)=>{try{let r=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(t,"&zoom=18&addressdetails=1")),n=await r.json();if(n.address){let e=n.address,t=[];return e.house_number&&t.push(e.house_number),e.road&&t.push(e.road),e.suburb?t.push(e.suburb):e.neighbourhood?t.push(e.neighbourhood):e.village?t.push(e.village):e.hamlet&&t.push(e.hamlet),e.city?t.push(e.city):e.town&&t.push(e.town),e.postcode&&t.push("Pin Code ".concat(e.postcode)),e.state&&t.push(e.state),e.country&&t.push(e.country),t.filter(Boolean).join(", ")||"Location detected"}return"Location detected"}catch(e){return console.error("Error fetching address:",e),"Location detected"}},R=async()=>{if(!p||!t||!k||!S||!Z||!b)return alert("Please fill all required fields.");if(M&&S<M)return alert("⏳ You must wait until ".concat(M," to schedule your next donation (56 days from last donation)."));let e=await fetch("http://localhost:5000/schedule/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({donorId:p,requestId:t,donorLocation:{latitude:b.lat,longitude:b.lng},contact:k,date:S,time:Z,notes:L})}),r=await e.json();r.success?(alert("Donation Schedule Confirmed!"),window.location.href="/donor/dashboard"):alert("Error: "+r.message)};return(0,n.jsx)("main",{className:"min-h-screen bg-red-50 p-10 flex justify-center",children:(0,n.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-xl max-w-2xl w-full border border-red-200",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-red-700 mb-6",children:"❤️ Schedule Blood Donation"}),(0,n.jsxs)("div",{className:"p-4 border border-red-200 rounded-lg mb-6 bg-red-50",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-red-700",children:"Hospital Information"}),(0,n.jsx)("p",{className:"mt-2 text-lg font-semibold",children:r||"Unknown Hospital"}),(0,n.jsxs)("p",{className:"mt-3 p-3 bg-red-100 rounded-lg text-red-700 font-semibold",children:["Needed: ",(0,n.jsxs)("b",{children:[m," units"]})," of ",(0,n.jsx)("b",{children:f})]})]}),(0,n.jsxs)("button",{onClick:()=>{navigator.geolocation.getCurrentPosition(async e=>{x({lat:e.coords.latitude,lng:e.coords.longitude}),v(!0);try{let t=await H(e.coords.latitude,e.coords.longitude);w(t)}catch(e){console.error("Error getting address:",e)}finally{v(!1)}alert("Location captured!")},()=>alert("Location access denied"))},className:"w-full bg-blue-600 text-white py-3 rounded-lg flex justify-center gap-2 items-center mb-4",children:[(0,n.jsx)(s.Z,{})," Share My Location"]}),b&&(0,n.jsxs)("p",{className:"text-green-700 mb-4 font-semibold",children:["Location: ",j?(0,n.jsx)("span",{className:"italic",children:"Loading address..."}):y||"Location detected"]}),O&&(0,n.jsx)("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 mb-4 rounded-lg",children:(0,n.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,n.jsx)(l.Z,{className:"text-amber-600 w-5 h-5 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-bold text-amber-800",children:"⏳ 56-Day Cooldown Period"}),(0,n.jsxs)("p",{className:"text-amber-700 text-sm mt-1",children:["Your last donation was on ",(0,n.jsx)("b",{children:D}),"."]}),(0,n.jsxs)("p",{className:"text-amber-700 text-sm font-semibold mt-1",children:["You can next schedule a donation after: ",(0,n.jsx)("b",{children:M})]})]})]})}),(0,n.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,n.jsx)(i.Z,{})," Contact Number"]}),(0,n.jsx)("input",{type:"text",placeholder:"Enter phone number",className:"w-full border rounded-lg p-3 mb-4",value:k,onChange:e=>N(e.target.value)}),(0,n.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,n.jsx)(c.Z,{})," Select Date"]}),(0,n.jsx)("input",{type:"date",className:"w-full border rounded-lg p-3 mb-2",value:S,onChange:e=>z(e.target.value),min:M||void 0,disabled:O}),_&&(0,n.jsx)("div",{className:"text-red-600 text-sm font-semibold mb-4 bg-red-50 p-3 rounded-lg border border-red-200",children:_}),!_&&S&&M&&S>=M&&(0,n.jsx)("div",{className:"text-green-600 text-sm font-semibold mb-4 bg-green-50 p-3 rounded-lg border border-green-200 flex items-center gap-2",children:"✅ This date is valid for scheduling your donation."}),(0,n.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,n.jsx)(d.Z,{})," Select Time"]}),(0,n.jsx)("input",{type:"time",className:"w-full border rounded-lg p-3 mb-4",value:Z,onChange:e=>E(e.target.value)}),(0,n.jsxs)("label",{className:"font-semibold flex items-center gap-2",children:[(0,n.jsx)(u.Z,{})," Notes (Optional)"]}),(0,n.jsx)("textarea",{placeholder:"Any additional information...",className:"w-full border rounded-lg p-3 mb-4 h-24",value:L,onChange:e=>P(e.target.value)}),(0,n.jsx)("button",{onClick:R,className:"w-full bg-red-600 text-white py-3 rounded-lg font-bold text-lg",children:"Confirm Donation Schedule"})]})})}function f(){return(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)("div",{className:"p-8",children:"Loading..."}),children:(0,n.jsx)(m,{})})}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...h}=e;return(0,n.createElement)("svg",{ref:t,...s,width:a,height:a,stroke:r,strokeWidth:i?24*Number(l)/Number(a):l,className:o("lucide",c),...h},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,n.forwardRef)((r,s)=>{let{className:i,...c}=r;return(0,n.createElement)(l,{ref:s,iconNode:t,className:o("lucide-".concat(a(e)),i),...c})});return r.displayName="".concat(e),r}},1047:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9322:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1723:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8736:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},3774:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},3041:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},4474:function(e,t,r){"use strict";r.d(t,{o:function(){return a}});class n extends Error{}function a(e,t){let r;if("string"!=typeof e)throw new n("Invalid token specified: must be a string");t||(t={});let a=!0===t.header?0:1,o=e.split(".")[a];if("string"!=typeof o)throw new n(`Invalid token specified: missing part #${a+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(o)}catch(e){throw new n(`Invalid token specified: invalid base64 for part #${a+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new n(`Invalid token specified: invalid json for part #${a+1} (${e.message})`)}}n.prototype.name="InvalidTokenError"}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7241)}),_N_E=e.O()}]);