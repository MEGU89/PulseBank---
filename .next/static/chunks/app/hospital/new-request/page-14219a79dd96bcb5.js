(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[557],{6795:function(e,t,o){Promise.resolve().then(o.bind(o,3926))},3926:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return d}});var l=o(7437),n=o(2265),a=o(9376),s=o(2660),r=o(8997),i=o(7648);function d(){let e=(0,a.useRouter)(),[t,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)({bloodType:"O+",unitsNeeded:1,urgency:"MODERATE",patientName:"",patientAge:0,reason:""}),u=e=>{let{name:t,value:o}=e.target;c(e=>({...e,[t]:"unitsNeeded"===t||"patientAge"===t?""===o?0:parseInt(o):o}))},g=async t=>{t.preventDefault(),o(!0);try{let t=localStorage.getItem("token"),l=localStorage.getItem("user");if(!t){alert("❌ You are not logged in. Please log in again."),o(!1);return}let n=null;if(t)try{n=JSON.parse(atob(t.split(".")[1])).userId}catch(e){console.log("Could not decode token, using localStorage")}if(!n&&l){let e=JSON.parse(l);n=(null==e?void 0:e._id)||(null==e?void 0:e.id)||(null==e?void 0:e.userId)}if(!n){alert("❌ Hospital ID not found. Please log in again."),o(!1);return}let a=l?JSON.parse(l):null,s=await fetch("http://localhost:5000/auth/user/".concat(n)),r=(await s.json()).user||a;console.log("[Hospital Request] Fresh hospital data from backend:",r),console.log("[Hospital Request] Hospital location from backend:",null==r?void 0:r.location),(null==r?void 0:r.location)?console.log("[Hospital Request] ✅ Location found - Lat:",r.location.latitude,"Lng:",r.location.longitude):console.warn("[Hospital Request] ⚠️ NO LOCATION FOUND - using fallback from localStorage");let i=(null==r?void 0:r.fullName)||(null==r?void 0:r.name)||(null==a?void 0:a.fullName)||(null==a?void 0:a.name);if(!i){alert("❌ Hospital name not found. Please log in again."),o(!1);return}if(!(null==r?void 0:r.location)||!r.location.latitude||!r.location.longitude){alert("❌ Hospital location not found!\n\nPlease update your hospital location in your profile before creating requests.\n\nThis will help donors find your blood requests on the map."),o(!1),e.push("/hospital/profile");return}let c={bloodType:d.bloodType,unitsNeeded:d.unitsNeeded,hospital:i,urgency:d.urgency,recipientName:d.patientName||null,locationKm:10,location:(null==r?void 0:r.location)?{latitude:r.location.latitude,longitude:r.location.longitude}:void 0,requestedBy:n};console.log("[Hospital Request] Payload being sent:",c);let u=await fetch("http://localhost:5000/request/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),g=await u.json();g.success?(alert("✅ Blood request created successfully!"),e.push("/hospital/dashboard")):alert("❌ Error: "+(g.message||"Could not create request"))}catch(e){console.error(e),alert("❌ Network error: "+(e instanceof Error?e.message:"Unknown error"))}finally{o(!1)}};return(0,l.jsxs)("main",{className:"min-h-screen bg-linear-to-br from-white via-red-50 to-white",children:[(0,l.jsx)("header",{className:"bg-linear-to-r from-red-600 to-red-700 text-white p-6 shadow-lg",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center gap-4",children:[(0,l.jsx)(i.default,{href:"/hospital/dashboard",className:"hover:bg-red-500 p-2 rounded-lg transition",children:(0,l.jsx)(s.Z,{className:"w-6 h-6"})}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(r.Z,{className:"w-8 h-8 fill-white"}),(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Create Blood Request"})]})]})}),(0,l.jsx)("div",{className:"max-w-2xl mx-auto p-6",children:(0,l.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-8",children:(0,l.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Blood Type *"}),(0,l.jsx)("select",{name:"bloodType",value:d.bloodType,onChange:u,title:"Blood Type Selection",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600",children:["O+","O-","A+","A-","B+","B-","AB+","AB-"].map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Units Needed *"}),(0,l.jsx)("input",{type:"number",name:"unitsNeeded",min:"1",max:"10",value:d.unitsNeeded,onChange:u,placeholder:"Enter units needed",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Urgency Level *"}),(0,l.jsxs)("select",{name:"urgency",value:d.urgency,onChange:u,title:"Urgency Level Selection",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600",children:[(0,l.jsx)("option",{value:"LOW",children:"Low"}),(0,l.jsx)("option",{value:"MODERATE",children:"Moderate"}),(0,l.jsx)("option",{value:"HIGH",children:"High"}),(0,l.jsx)("option",{value:"CRITICAL",children:"Critical"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Patient Name"}),(0,l.jsx)("input",{type:"text",name:"patientName",value:d.patientName,onChange:u,placeholder:"Enter patient name",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Patient Age"}),(0,l.jsx)("input",{type:"number",name:"patientAge",min:"0",max:"120",value:d.patientAge,onChange:u,placeholder:"Enter patient age",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reason for Request"}),(0,l.jsx)("textarea",{name:"reason",value:d.reason,onChange:u,placeholder:"e.g., Emergency surgery, accident, chronic condition...",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,l.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,l.jsx)("button",{type:"submit",disabled:t,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:t?"Creating...":"Create Request"}),(0,l.jsx)(i.default,{href:"/hospital/dashboard",className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-3 rounded-lg text-center transition",children:"Cancel"})]})]})})})]})}},2660:function(e,t,o){"use strict";o.d(t,{Z:function(){return l}});let l=(0,o(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8997:function(e,t,o){"use strict";o.d(t,{Z:function(){return l}});let l=(0,o(9205).Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},9376:function(e,t,o){"use strict";var l=o(5475);o.o(l,"useParams")&&o.d(t,{useParams:function(){return l.useParams}}),o.o(l,"useRouter")&&o.d(t,{useRouter:function(){return l.useRouter}}),o.o(l,"useSearchParams")&&o.d(t,{useSearchParams:function(){return l.useSearchParams}})}},function(e){e.O(0,[216,971,117,744],function(){return e(e.s=6795)}),_N_E=e.O()}]);