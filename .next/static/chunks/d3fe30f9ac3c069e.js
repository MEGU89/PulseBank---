(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},55842,e=>{"use strict";var t=e.i(43476),s=e.i(71645),l=e.i(46897),a=e.i(43432),r=e.i(63209),n=e.i(69638),i=e.i(96390),o=e.i(90597),d=e.i(70703),c=e.i(22016);let h=(0,d.default)(()=>e.A(46796),{loadableGenerated:{modules:[8235]},ssr:!1});function x({hospitalRequests:e,donorLocation:d}){let[x,m]=(0,s.useState)([]),[u,p]=(0,s.useState)(null),[b,g]=(0,s.useState)({}),[f,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(d&&e&&e.length>0){console.log("[HospitalRequestsMap] Received requests:",e);let t=e.map(e=>{if(e.location&&e.location.latitude&&e.location.longitude){var t,s,l,a;let r,n,i,o=(t=d.lat,s=d.lng,l=e.location.latitude,a=e.location.longitude,Math.round(2*Math.atan2(Math.sqrt(i=Math.sin((r=(l-t)*Math.PI/180)/2)*Math.sin(r/2)+Math.cos(t*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin((n=(a-s)*Math.PI/180)/2)*Math.sin(n/2)),Math.sqrt(1-i))*63710)/10);return{...e,distance:Math.round(10*o)/10}}return{...e,distance:null}}).filter(e=>null!==e&&(null===e.distance||e.distance<=20)).sort((e,t)=>null===e.distance?1:null===t.distance?-1:e.distance-t.distance);m(t);let s=t.reduce((e,t)=>{let s=t.hospital||"Hospital";return e[s]||(e[s]=[]),e[s].push(t),e},{});g(s),console.log("[HospitalRequestsMap] Grouped by hospital:",Object.keys(s))}},[d,e]);let N=x.length>0?x.filter(e=>e.location&&e.location.latitude&&e.location.longitude).map(e=>({location:e.location,name:e.hospital||"Hospital",notes:`${e.unitsNeeded||"?"} units â€” ${e.bloodType||"?"}${e.recipientName?` (${e.recipientName})`:""}`})):[],y=Object.keys(b).map(e=>{let t=b[e],s=t[0];return{name:e,distance:s.distance,requestCount:t.length,phone:s.phone,address:s.location?.address}}).sort((e,t)=>null===e.distance?1:null===t.distance?-1:(e.distance||0)-(t.distance||0));return(0,t.jsxs)("div",{className:"space-y-6 bg-white rounded-2xl shadow-xl p-8 border-2 border-red-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)(i.Droplet,{className:"w-8 h-8 text-red-600 fill-red-600"}),(0,t.jsx)("h2",{className:"text-3xl font-bold text-red-700",children:"Nearby Blood Requests"})]}),N.length>0&&(0,t.jsx)("div",{className:"rounded-2xl overflow-hidden shadow-lg h-96 border-2 border-red-100 mb-8",children:(0,t.jsx)(h,{hospitals:N,activeDonors:[],currentLocation:d})}),y.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-600",children:[(0,t.jsx)("p",{className:"text-xs font-bold text-red-700 uppercase tracking-wide",children:"ðŸ¥ Select Hospital to View All Requests"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[y.length," hospitals found within 0-20 km"]})]}),(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map((e,s)=>(0,t.jsxs)("button",{onClick:()=>p(u===e.name?null:e.name),className:`p-4 rounded-xl text-left transition-all duration-200 border-2 ${u===e.name?"bg-red-100 border-red-600 shadow-lg":"bg-gradient-to-r from-white to-red-50 border-red-200 hover:border-red-400 hover:shadow-md"}`,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsx)("h3",{className:"font-bold text-gray-800 text-sm line-clamp-2 flex-1",children:e.name}),(0,t.jsxs)("span",{className:"bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full flex-shrink-0 ml-2",children:[e.distance?.toFixed(1)||"0"," km"]})]}),(0,t.jsxs)("div",{className:"space-y-1 text-xs text-gray-600 mb-2",children:[e.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(a.Phone,{className:"w-3 h-3 text-red-500"}),(0,t.jsx)("span",{className:"font-semibold",children:e.phone})]}),e.address&&(0,t.jsxs)("div",{className:"flex items-start gap-1",children:[(0,t.jsx)(l.MapPin,{className:"w-3 h-3 text-blue-500 flex-shrink-0 mt-0.5"}),(0,t.jsx)("span",{className:"line-clamp-2",children:e.address})]})]}),(0,t.jsxs)("div",{className:"inline-block bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:[e.requestCount," request",e.requestCount>1?"s":""]})]},s))})]}):d?(0,t.jsxs)("div",{className:"bg-blue-50 rounded-2xl p-12 text-center border-2 border-blue-200",children:[(0,t.jsx)(o.Heart,{className:"w-16 h-16 text-blue-300 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"No hospital requests found"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Check back later for new blood requests"})]}):(0,t.jsxs)("div",{className:"bg-blue-50 rounded-2xl p-12 text-center border-2 border-blue-200",children:[(0,t.jsx)(l.MapPin,{className:"w-16 h-16 text-blue-300 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"Share your location to see nearby requests"})]}),u&&b[u]&&(0,t.jsxs)("div",{className:"mt-8 pt-8 border-t-4 border-red-300",children:[(0,t.jsxs)("h3",{className:"text-2xl font-bold text-red-700 mb-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-3xl",children:"ðŸ“"}),u]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:["Showing ",b[u].length," total request(s) - Hospital (",b[u].filter(e=>!e.isRecipientRequest).length,") & Recipient (",b[u].filter(e=>e.isRecipientRequest).length,") requests"]}),(0,t.jsx)("div",{className:"space-y-4",children:b[u].map((e,s)=>(0,t.jsxs)("div",{className:`border-2 rounded-xl p-6 hover:shadow-lg transition-all ${e.isRecipientRequest?"bg-gradient-to-r from-white to-purple-50 border-purple-200":"bg-gradient-to-r from-white to-blue-50 border-blue-200"}`,children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[e.isRecipientRequest?(0,t.jsxs)("span",{className:"bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:["RE-",e._id?.substring(0,6).toUpperCase()]}):(0,t.jsxs)("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:["HRE-",e._id?.substring(0,6).toUpperCase()]}),(0,t.jsxs)("span",{className:"text-sm font-semibold text-gray-700",children:[e.bloodType," â€¢ ",e.unitsNeeded," units"]})]}),e.recipientName&&(0,t.jsxs)("div",{className:"bg-purple-50 rounded-lg p-2 border-l-2 border-purple-600 mb-3",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 font-bold",children:"PATIENT NAME"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-purple-700",children:e.recipientName})]}),(0,t.jsxs)("div",{className:"text-sm space-y-1 text-gray-700",children:[e.phone&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Phone:"})," ",e.phone]}),e.urgency&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Urgency:"})," ",(0,t.jsx)("span",{className:"text-orange-600 font-bold",children:e.urgency})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 justify-center",children:[(0,t.jsx)(c.default,{href:`/donor/schedule-donation?requestId=${e._id}&hospital=${encodeURIComponent(e.hospital||"")}&units=${e.unitsNeeded}&bloodType=${encodeURIComponent(e.bloodType||"")}`,className:"block",children:(0,t.jsxs)("button",{className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-4 rounded-lg font-bold text-sm transition-all duration-200 shadow-md hover:shadow-lg active:scale-95 flex items-center justify-center gap-2",children:[(0,t.jsx)(n.CheckCircle,{className:"w-4 h-4"}),"Confirm & Schedule"]})}),(0,t.jsxs)("button",{onClick:async()=>{try{let t=await fetch(`http://localhost:5000/request/${e._id}/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"Rejected",confirmedBy:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")||"{}").id:null,notes:"Request rejected by donor"})}),s=await t.json();s.success?(alert("âŒ Request rejected successfully"),m(t=>t.filter(t=>t._id!==e._id))):alert("Error: "+(s.message||"Unknown error"))}catch(e){alert("Error: "+(e instanceof Error?e.message:"Unknown error"))}},className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 px-4 rounded-lg font-bold text-sm transition-all duration-200 shadow-md hover:shadow-lg active:scale-95 flex items-center justify-center gap-2",children:[(0,t.jsx)(r.AlertCircle,{className:"w-4 h-4"}),"Reject"]})]})]}),e.location?.address&&(0,t.jsxs)("div",{className:"text-sm text-gray-600 flex items-start gap-2 pt-3 border-t border-red-200",children:[(0,t.jsx)(l.MapPin,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),(0,t.jsx)("span",{children:e.location.address})]})]},s))})]})]})}e.s(["default",()=>x])},25153,e=>{e.n(e.i(55842))},46796,e=>{e.v(t=>Promise.all(["static/chunks/622efa97a5fc3562.js"].map(t=>e.l(t))).then(()=>t(8235)))}]);